apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: "worker"
  name: 99-kvc-kmod
spec:
  config:
     ignition:
       version: 3.1.0
     storage:
       files:
       - contents:
           source: data:text/plain;charset=us-ascii;base64,cmVnbWFwX3NwaV9hdm1t
         mode: 420
         overwrite: true
         path: /etc/modules-load.d/regmap_spi_avmm.conf
       - contents:
           source: data:text/plain;charset=us-ascii;base64,IyBUaGUgY29uZmlndXJhdGlvbiBmaWxlIGZvciB0aGUgc2ltcGxlLWttb2Qga2VybmVsIG1vZHVsZQojIHNvZnRhcmUgYnVuZGxlIHRoYXQgaXMgdG8gYmUgdXNlZCB3aXRoIHRoZSBrbW9kcy12aWEtY29udGFpbmVycwojIGZyYW1ld29yay4KZXhwb3J0IEdPREVCVUc9eDUwOWlnbm9yZUNOPTAKCnNvdXJjZSAvZXRjL29zLXJlbGVhc2UKCktNT0RfQ09OVEFJTkVSX0JVSUxEX0NPTlRFWFQ9Imh0dHBzOi8vZ2l0aHViLmNvbS9ybXItc2lsaWNvbS9tYWNoaW5lLWNvbmZpZy1rbW9kLmdpdCIKS01PRF9DT05UQUlORVJfQlVJTERfRklMRT0vZXRjL2t2Yy9Eb2NrZXJmaWxlLmNlbnRvcwoKS1ZDX0tWRVI9IjQuMTguMC0xOTMuZWw4Lng4Nl82NCIKQ0VOVE9TX1ZFUj1kb2NrZXIuaW8vY2VudG9zOjguMi4yMDA0CmlmIFsgJFJIRUxfVkVSU0lPTiA9ICI4LjMiIF0gOyB0aGVuCiAgICBLVkNfS1ZFUj0iNC4xOC4wLTI0MC5lbDgueDg2XzY0IgogICAgQ0VOVE9TX1ZFUj1kb2NrZXIuaW8vY2VudG9zOjguMy4yMDExCmZpCktNT0RfUkVQT1M9cXVheS5pby9yeWFuX3JhYXNjaApLVkNfU09GVFdBUkVfTkFNRT1kZmwta21vZApLTU9EVkVSPWVlYTljYmMKS01PRF9OQU1FUz0iZGZsLXBjaSBkZmwtYWZ1IGRmbC1mbWUgZGZsIGludGVsLW0xMC1ibWMgaW50ZWwtczEwLXBoeSByZWdtYXAtaW5kaXJlY3QtcmVnaXN0ZXIgaW50ZWwtbTEwLWJtYy1od21vbiBpbnRlbC1tMTAtYm1jLXNlY3VyZSBuNTAxMC1waHkiCklNQUdFPSR7S1ZDX1NPRlRXQVJFX05BTUV9OiR7S01PRFZFUn0tJHtLVkNfS1ZFUn0K
         mode: 420
         overwrite: true
         path: /etc/kvc/dfl-kmod.conf
       - contents:
           source: data:text/plain;charset=us-ascii;base64,QVJHIENFTlRPU19WRVI9ZG9ja2VyLmlvL2NlbnRvczo4LjIuMjAwNApGUk9NICR7Q0VOVE9TX1ZFUn0KCldPUktESVIgL3Jvb3QKCkFSRyBLTU9EVkVSCkFSRyBLVkVSCkFSRyBSUE1fVVJMPSJodHRwczovL3ZhdWx0LmNlbnRvcy5vcmcvOC4yLjIwMDQvQmFzZU9TL3g4Nl82NC9vcy9QYWNrYWdlcy9rZXJuZWwtZGV2ZWwtNC4xOC4wLTE5My5lbDgueDg2XzY0LnJwbSIKClJVTiBlY2hvICJmYXN0ZXN0bWlycm9yPTEiID4+IC9ldGMvZG5mL2RuZi5jb25mClJVTiBkbmYgaW5zdGFsbCAteSAke1JQTV9VUkx9ClJVTiB5dW0gaW5zdGFsbCAteSBnaXQtY29yZSBnY2MgZWxmdXRpbHMtbGliZWxmLWRldmVsIG1ha2Uga21vZAoKUlVOIGdpdCBjbG9uZSAtLWJyYW5jaCBuNTAxMC9mcGdhLW9mcy1kZXYtNS4xMC1sdHMgaHR0cHM6Ly9naXRodWIuY29tL09QQUUvbGludXgtZGZsLWJhY2twb3J0LmdpdCAmJiBcCiAgICBjZCBsaW51eC1kZmwtYmFja3BvcnQgJiYgXAogICAgZ2l0IGNoZWNrb3V0ICR7S01PRFZFUn0gJiYgXAogICAgZ3JlcCAtbCAtdiAtciBNT0RVTEVfVkVSU0lPTiBkcml2ZXJzLyB8IHhhcmdzIHNlZCAtaSAnL15NT0RVTEVfTElDRU5TRS8gcy8kL1xuTU9EVUxFX1ZFUlNJT04oS01PRFZFUik7LycgJiYgXAogICAgY2QgLQoKUlVOIGVjaG8gImV4cG9ydCBLRVJORUw9JChycG0gLXFhIGtlcm5lbC1kZXZlbCAtLXF1ZXJ5Zm9ybWF0IFwiJXtWRVJTSU9OfS0le1JQTVRBR19SRUxFQVNFfS4le0FSQ0h9XCIpIiA+IC9yb290L2VudiAmJiBcCiAgICBlY2hvICJleHBvcnQgS0VSTkVMRElSPS9saWIvbW9kdWxlcy9cJEtFUk5FTC9idWlsZCIgPj4gL3Jvb3QvZW52ICYmIFwKICAgIGVjaG8gImV4cG9ydCBLTU9EVkVSPSR7S01PRFZFUn0iID4+IC9yb290L2VudgoKUlVOIHNvdXJjZSAvcm9vdC9lbnYgJiYgXAogICAgYmFzaCAtYyAiaWYgWyAhIC1lICRLRVJORUxESVIgXSA7IHRoZW4gbWtkaXIgLXAgL2xpYi9tb2R1bGVzL1wkS0VSTkVMIDsgbG4gLXMgL3Vzci9zcmMva2VybmVscy9cJEtFUk5FTCAvbGliL21vZHVsZXMvXCRLRVJORUwvYnVpbGQ7IGZpIiBcCiAgICBybSAtcmYgL2xpYi9tb2R1bGVzLyR7S1ZFUn0va2VybmVsICYmIFwKICAgIG1ha2UgLUMgbGludXgtZGZsLWJhY2twb3J0ICJFWFRSQV9DRkxBR1M9LURLTU9EVkVSPVxcXCIke0tNT0RWRVJ9XFxcIiIgLWo0ICYmIFwKICAgIG1ha2UgLUMgbGludXgtZGZsLWJhY2twb3J0IGluc3RhbGwgLWo0ICYmIFwKICAgIGRlcG1vZCAtYSAke0tWRVJ9CgoKRlJPTSByZWdpc3RyeS5hY2Nlc3MucmVkaGF0LmNvbS91Ymk4L3ViaS1taW5pbWFsClJVTiBtaWNyb2RuZiBpbnN0YWxsIGttb2QKUlVOIG1rZGlyIC1wIC9saWIvbW9kdWxlcy8ke0tWRVJ9CkNPUFkgLS1mcm9tPTAgL2xpYi9tb2R1bGVzLyR7S1ZFUn0gL2xpYi9tb2R1bGVzLyR7S1ZFUn0K
         mode: 420
         overwrite: true
         path: /etc/kvc/Dockerfile.centos
       - contents:
           source: data:text/plain;charset=us-ascii;base64,IyBUaGlzIGNvbmZpZ3VyYXRpb24gZmlsZSBpcyBtZWFudCB0byBiZSB1c2VkIHdpdGggdGhlCiMga21vZHMtdmlhLWNvbnRhaW5lcnMgc29mdHdhcmUgc3RhY2sgdGhhdCBpbnRlbmRzIHRvIGJ1aWxkCiMgYW5kIGRlbGl2ZXIga2VybmVsIG1vZHVsZXMgdmlhIGNvbnRhaW5lciBidWlsZHMvaW1hZ2VzLgoKIyBUaGUgY29udGFpbmVyIHJ1bnRpbWUgdG8gdXNlIGZvciBidWlsZGluZy9leGVjdXRpbmcgY29udGFpbmVycwpLVkNfQ09OVEFJTkVSX1JVTlRJTUU9cG9kbWFuCg==
         mode: 420
         overwrite: true
         path: /etc/kvc/kmods-via-containers.conf
       - contents:
           source: data:text/plain;charset=us-ascii;base64,W1VuaXRdCkRlc2NyaXB0aW9uPUttb2RzIFZpYSBDb250YWluZXJzIC0gJWkKIyBTdGFydCBhZnRlciB0aGUgbmV0d29yayBpcyB1cApXYW50cz1uZXR3b3JrLW9ubGluZS50YXJnZXQKQWZ0ZXI9bmV0d29yay1vbmxpbmUudGFyZ2V0CiMgQWxzbyBhZnRlciBkb2NrZXIuc2VydmljZSAobm8gZWZmZWN0IG9uIHN5c3RlbXMgd2l0aG91dCBkb2NrZXIpCkFmdGVyPWRvY2tlci5zZXJ2aWNlCiMgQmVmb3JlIGt1YmVsZXQuc2VydmljZSAobm8gZWZmZWN0IG9uIHN5c3RlbXMgd2l0aG91dCBrdWJlcm5ldGVzKQpCZWZvcmU9a3ViZWxldC5zZXJ2aWNlCiMgQnV0IGJlZm9yZSB1c2VycyBhcmUgYWxsb3dlZCB0byBsb2dpbgpCZWZvcmU9c3lzdGVtZC11c2VyLXNlc3Npb25zLnNlcnZpY2UKCltTZXJ2aWNlXQpUeXBlPW9uZXNob3QKVGltZW91dFN0YXJ0U2VjPTI1bQpSZW1haW5BZnRlckV4aXQ9dHJ1ZQojIFVzZSBiYXNoIHRvIHdvcmthcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2NvcmVvcy9ycG0tb3N0cmVlL2lzc3Vlcy8xOTM2CkV4ZWNTdGFydFByZT0vdXNyL2Jpbi9iYXNoIC1jICJrbW9kcy12aWEtY29udGFpbmVycyBidWlsZCAlaSAldiIKRXhlY1N0YXJ0PS91c3IvYmluL2Jhc2ggLWMgImttb2RzLXZpYS1jb250YWluZXJzIGxvYWQgJWkgJXYiCkV4ZWNSZWxvYWQ9L3Vzci9iaW4vYmFzaCAtYyAia21vZHMtdmlhLWNvbnRhaW5lcnMgcmVsb2FkICVpICV2IgpFeGVjU3RvcD0vdXNyL2Jpbi9iYXNoIC1jICJrbW9kcy12aWEtY29udGFpbmVycyB1bmxvYWQgJWkgJXYiClN0YW5kYXJkT3V0cHV0PWpvdXJuYWwrY29uc29sZQoKW0luc3RhbGxdCldhbnRlZEJ5PWRlZmF1bHQudGFyZ2V0Cg==
         mode: 420
         overwrite: true
         path: /etc/systemd/system/kmods-via-containers@.service
       - contents:
           source: data:text/plain;charset=us-ascii;base64,YmxhY2tsaXN0IGludGVsX20xMF9ibWNfcmV0aW1lciBpbnRlbF9tMTBfYm1jX3NlY3VyZSBuNTAxMF9waHkgaW50ZWxfbTEwX2JtYw==
         mode: 420
         overwrite: true
         path: /etc/modprobe.d/blacklist-bmc.conf
       - contents:
           source: data:text/x-shellscript;charset=us-ascii;base64,IyEvYmluL2Jhc2gKCiMgVGhlIE1JVCBMaWNlbnNlCgojIENvcHlyaWdodCAoYykgMjAxOSBEdXN0eSBNYWJlCgojIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKIyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAojIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKIyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiMgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCiMgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KIyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCiMgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKIyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKIyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKIyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiMgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKIyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiMgVEhFIFNPRlRXQVJFLgoKc2V0IC1ldQoKIyBIZWxwZXIgZnVuY3Rpb25zIGZvciBydW5uaW5nIGNvbnRhaW5lcnMKIyBVc2Ugc2V0IC14IHRvIHByaW50IG91dCB0aGUgcnVudGltZSBDTEkgdG8gbG9nCiMgUnVuIGluIGEgc3Vic2hlbGwgc28gd2UgZG9uJ3QgYWxzbyBzZWUgYHNldCAreGAKa3ZjX2NfcnVuKCkgICB7IChzZXQgLXg7ICRLVkNfQ09OVEFJTkVSX1JVTlRJTUUgcnVuIC1pIC0tcm0gJEAgKTsgfQprdmNfY19idWlsZCgpIHsgKHNldCAteDsgJEtWQ19DT05UQUlORVJfUlVOVElNRSBidWlsZCAgJEAgKTsgfQprdmNfY19pbWFnZXMoKXsgKHNldCAteDsgJEtWQ19DT05UQUlORVJfUlVOVElNRSBpbWFnZXMgJEAgKTsgfQprdmNfY19ybWkoKSAgIHsgKHNldCAteDsgJEtWQ19DT05UQUlORVJfUlVOVElNRSBybWkgICAgJEAgKTsgfQoKIyBEZWZpbmUgdGhlc2UgZnVuY3Rpb25zIGluIHlvdXIgbGlicmFyeSBmaWxlCmJ1aWxkX2ttb2RzKCkgewogICAgZWNobyAiYnVpbGRfa21vZHMgaXMgdW5pbXBsZW1lbnRlZCBmb3IgJHtLVkNfU09GVFdBUkVfTkFNRX0hIiAyPiYxCiAgICByZXR1cm4gMQp9CmxvYWRfa21vZHMoKSB7CiAgICBlY2hvICJsb2FkX2ttb2RzIGlzIHVuaW1wbGVtZW50ZWQgZm9yICR7S1ZDX1NPRlRXQVJFX05BTUV9ISIgMj4mMQogICAgcmV0dXJuIDEKfQp1bmxvYWRfa21vZHMoKSB7CiAgICBlY2hvICJ1bmxvYWRfa21vZHMgaXMgdW5pbXBsZW1lbnRlZCBmb3IgJHtLVkNfU09GVFdBUkVfTkFNRX0hIiAyPiYxCiAgICByZXR1cm4gMQp9CndyYXBwZXIoKSB7CiAgICBlY2hvICJ3cmFwcGVyIGlzIHVuaW1wbGVtZW50ZWQgZm9yICR7S1ZDX1NPRlRXQVJFX05BTUV9ISIgMj4mMQogICAgcmV0dXJuIDEKfQoKS1ZDX0FDVElPTj0kMTsgc2hpZnQKS1ZDX1NPRlRXQVJFX05BTUU9JDE7IHNoaWZ0CktWQ19LVkVSPSQxOyBzaGlmdAplY2hvICJLVkM6ICR7S1ZDX0FDVElPTn0gJHtLVkNfU09GVFdBUkVfTkFNRX0gZm9yICR7S1ZDX0tWRVJ9IgoKIyBTb3VyY2UgaW4gY29uZmlndXJhdGlvbiBmb3IgdGhlIEtWQyBmcmFtZXdvcmsKc291cmNlICIvZXRjL2t2Yy9rbW9kcy12aWEtY29udGFpbmVycy5jb25mIgojIFNvdXJjZSBpbiB0aGUgbGlicmFyeSB0aGF0IGRlZmluZXMge2J1aWxkLGxvYWQsdW5sb2FkfV9rbW9kcyx3cmFwcGVyCiMgbXVzdCBiZSBpbiBvbmUgb2YgL3Vzci97LGxvY2FsL31saWIva3ZjLyR7S1ZDX1NPRlRXQVJFX05BTUV9LWxpYi5zaApmb3IgaW5zdGFuY2VfbGlicmFyeSBpbiAvdXNyL3tsb2NhbC8sfWxpYi9rdmMvJHtLVkNfU09GVFdBUkVfTkFNRX0tbGliLnNoOyBkbwogICAgaWYgWyAtZiAiJHtpbnN0YW5jZV9saWJyYXJ5fSIgXTsgdGhlbgogICAgICAgIHNvdXJjZSAiJHtpbnN0YW5jZV9saWJyYXJ5fSIKICAgICAgICBmb3VuZD0xCiAgICBmaQpkb25lCmlmIFsgIiR7Zm91bmQtfSIgIT0gMSBdOyB0aGVuCiAgICBlY2hvICJLVkMgcmVxdWlyZXMgYW4gaW5zdGFuY2UgbGlicmFyeSIgXAogICAgICAgICAidG8gZGVmaW5lIHNpZ25pZmljYW50IGZ1bmN0aW9uYWxpdHkiIDI+JjEKICAgIGVjaG8gIk5vIGluc3RhbmNlIGxpYnJhcnkgZm91bmQgaW4gb25lIG9mIHJlcXVpcmVkIGxvY2F0aW9ucyIgXAogICAgICAgICAvdXNyL3tsb2NhbC8sfWxpYi9rdmMvJHtLVkNfU09GVFdBUkVfTkFNRX0tbGliLnNoIDI+JjEKICAgIGV4aXQgMQpmaQoKY2FzZSAiJHtLVkNfQUNUSU9OfSIgaW4KICAgIGJ1aWxkKQogICAgICAgIGJ1aWxkX2ttb2RzCiAgICA7OwogICAgbG9hZCkKICAgICAgICBsb2FkX2ttb2RzCiAgICA7OwogICAgdW5sb2FkKQogICAgICAgIHVubG9hZF9rbW9kcwogICAgOzsKICAgIHJlbG9hZCkKICAgICAgICBidWlsZF9rbW9kcwogICAgICAgIHVubG9hZF9rbW9kcwogICAgICAgIGxvYWRfa21vZHMKICAgIDs7CiAgICB3cmFwcGVyKQogICAgICAgICMgd3JhcHMvcnVucyBleGVjdXRhYmxlcyBmcm9tIHdpdGhpbiB0aGUga2VybmVsIG1vZHVsZSBjb250YWluZXIKICAgICAgICB3cmFwcGVyICRACiAgICA7OwogICAgKikKICAgICAgICBlY2hvICJVbmtub3duIGNvbW1hbmQuIEV4aXRpbmcuIgogICAgICAgIGVjaG8gIlVzYWdlOiIKICAgICAgICBlY2hvICIiCiAgICAgICAgZWNobyAiYnVpbGQgICAgICAgQnVpbGQga2VybmVsIG1vZHVsZShzKSB2aWEgY29udGFpbmVyIgogICAgICAgIGVjaG8gImxvYWQgICAgICAgIExvYWQga2VybmVsIG1vZHVsZShzKSIKICAgICAgICBlY2hvICJ1bmxvYWQgICAgICBVbmxvYWQga2VybmVsIG1vZHVsZShzKSIKICAgICAgICBlY2hvICJyZWxvYWQgICAgICBCdWlsZCBhbmQgcmVsb2FkIGtlcm5lbCBtb2R1bGUocykiCiAgICAgICAgZWNobyAid3JhcHBlciAgICAgUnVuIHVzZXJzcGFjZSB0b29scyBmcm9tIHdpdGhpbiB0aGUgY29udGFpbmVyIgogICAgICAgIGV4aXQgMQplc2FjCg==
         mode: 493
         overwrite: true
         path: /usr/local/bin/kmods-via-containers
       - contents:
           source: data:text/x-shellscript;charset=us-ascii;base64,IyEvYmluL2Jhc2gKCiMgVGhlIE1JVCBMaWNlbnNlCgojIENvcHlyaWdodCAoYykgMjAxOSBEdXN0eSBNYWJlCgojIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKIyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAojIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKIyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiMgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCiMgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KIyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCiMgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKIyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKIyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKIyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiMgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKIyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiMgVEhFIFNPRlRXQVJFLgoKc2V0IC1ldQoKIyBUaGlzIGxpYnJhcnkgaXMgdG8gYmUgc291cmNlZCBpbiBhcyBwYXJ0IG9mIHRoZSBrbW9kcy12aWEtY29udGFpbmVycwojIGZyYW1ld29yay4gVGhlcmUgYXJlIHNvbWUgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRoYXQgYXJlIHVzZWQgaW4gdGhpcwojIGZpbGUgdGhhdCBhcmUgZXhwZWN0ZWQgdG8gYmUgZGVmaW5lZCBieSB0aGUgZnJhbWV3b3JrIGFscmVhZHk6CiMgLSBLVkNfQ09OVEFJTkVSX1JVTlRJTUUKIyAgIC0gVGhlIGNvbnRhaW5lciBydW50aW1lIHRvIHVzZSAoZXhhbXBsZTogcG9kbWFufGRvY2tlcikKIyAtIEtWQ19TT0ZUV0FSRV9OQU1FCiMgICAtIFRoZSBuYW1lIG9mIHRoaXMgbW9kdWxlIHNvZnR3YXJlIGJ1bmRsZQojIC0gS1ZDX0tWRVIKIyAgIC0gVGhlIGtlcm5lbCB2ZXJzaW9uIHdlIGFyZSB0YXJnZXRpbmcKCiMgVGhlcmUgYXJlIG90aGVyIGVudmlyb25tZW50IHZhcmlhYmxlcyB0aGF0IGNvbWUgZnJvbSB0aGUgY29uZmlnIGZpbGUKIyBkZWxpdmVyZWQgYWxvbmdzaWRlIHRoaXMgbGlicmFyeS4gVGhlIGV4cGVjdGVkIHZhcmlhYmxlcyBhcmU6CiMgLSBLTU9EX0NPTlRBSU5FUl9CVUlMRF9DT05URVhUCiMgICAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgbG9jYXRpb24gb2YgdGhlIGJ1aWxkIGNvbnRleHQKIyAtIEtNT0RfQ09OVEFJTkVSX0JVSUxEX0ZJTEUKIyAgIC0gVGhlIG5hbWUgb2YgdGhlIGZpbGUgaW4gdGhlIGNvbnRleHQgd2l0aCB0aGUgYnVpbGQgZGVmaW5pdGlvbgojICAgICAoaS5lLiBEb2NrZXJmaWxlKQojIC0gS01PRFZFUgojICAgLSBUaGUgdmVyc2lvbiBvZiB0aGUgc29mdHdhcmUgYnVuZGxlCiMgLSBLTU9EX05BTUVTCiMgICAtIEEgc3BhY2Ugc2VwYXJhdGVkIGxpc3Qga2VybmVsIG1vZHVsZSBuYW1lcyB0aGF0IGFyZSBwYXJ0IG9mIHRoZQojICAgICBtb2R1bGUgc29mdHdhcmUgYnVuZGxlIGFuZCBhcmUgdG8gYmUgY2hlY2tlZC9sb2FkZWQvdW5sb2FkZWQKc291cmNlICIvZXRjL2t2Yy8ke0tWQ19TT0ZUV0FSRV9OQU1FfS5jb25mIgoKIyBUaGUgbmFtZSBvZiB0aGUgY29udGFpbmVyIGltYWdlIHRvIGNvbnNpZGVyLiBJdCB3aWxsIGJlIGEgdW5pcXVlCiMgY29tYmluYXRpb24gb2YgdGhlIG1vZHVsZSBzb2Z0d2FyZSBuYW1lL3ZlcnNpb24gYW5kIHRoZSB0YXJnZXRlZAojIGtlcm5lbCB2ZXJzaW9uLgojIElNQUdFPSIke0tNT0RfUkVQT1N9LyR7S1ZDX1NPRlRXQVJFX05BTUV9OiR7S01PRFZFUn0tJHtLVkNfS1ZFUn0iCgpidWlsZF9rbW9kX2NvbnRhaW5lcigpIHsKICAgIGlmICEgJChsc3BjaSAtZCAxYzJjOiB8IGdyZXAgLXEgU2lsaWNvbSkgOyB0aGVuCiAgICAgICAgZWNobyAiTm8gU2lsaWNvbSBGUEdBIGNhcmQgb24gdGhpcyBub2RlIgogICAgICAgIHJldHVybgogICAgZmkKCiAtLWJ1aWxkLWFyZyBSUE1fVVJMPSQoUkhFTDgyX1JQTSkgLS1idWlsZC1hcmcgS01PRFZFUj0kKEtNT0RWRVIpIC0tYnVpbGQtYXJnIEtWRVI9JChLVkVSX1JIRUw4MikKICAgIGVjaG8gIkJ1aWxkaW5nICR7SU1BR0V9IGtlcm5lbCBtb2R1bGUgY29udGFpbmVyLi4uIgogICAga3ZjX2NfYnVpbGQgLS10bHMtdmVyaWZ5PWZhbHNlIC10ICR7S01PRF9SRVBPU30vJHtJTUFHRX0gICBcCiAgICAgICAgLS1maWxlICR7S01PRF9DT05UQUlORVJfQlVJTERfRklMRX0gICAgICAgICAgXAogICAgICAgIC0tbGFiZWw9Im5hbWU9JHtLVkNfU09GVFdBUkVfTkFNRX0iICAgICAgICAgIFwKICAgICAgICAtLWJ1aWxkLWFyZyBDRU5UT1NfVkVSPSR7Q0VOVE9TX1ZFUn0gICAgICAgICBcCiAgICAgICAgLS1idWlsZC1hcmcgS1ZFUj0ke0tWQ19LVkVSfSAgICAgICAgICAgICAgICAgXAogICAgICAgIC0tYnVpbGQtYXJnIEtNT0RWRVI9JHtLTU9EVkVSfSBcCiAgICAgICAgJHtLTU9EX0NPTlRBSU5FUl9CVUlMRF9DT05URVhUfQoKICAgICMgZ2V0IHJpZCBvZiBhbnkgZGFuZ2xpbmcgY29udGFpbmVycyBpZiB0aGV5IGV4aXN0CiAgICBlY2hvICJDaGVja2luZyBmb3Igb2xkIGtlcm5lbCBtb2R1bGUgaW1hZ2VzIHRoYXQgbmVlZCB0byBiZSByZWN5Y2xlZCIKICAgIHJtaTE9JChrdmNfY19pbWFnZXMgLXEgLWYgbGFiZWw9Im5hbWU9JHtLVkNfU09GVFdBUkVfTkFNRX0iIC1mIGRhbmdsaW5nPXRydWUpCiAgICAjIGtlZXAgYXJvdW5kIGFueSBub24tZGFuZ2xpbmcgaW1hZ2VzIGZvciBvbmx5IHRoZSBtb3N0IHJlY2VudCAzIGtlcm5lbHMKICAgIHJtaTI9JChrdmNfY19pbWFnZXMgLXEgLWYgbGFiZWw9Im5hbWU9JHtLVkNfU09GVFdBUkVfTkFNRX0iIC1mIGRhbmdsaW5nPWZhbHNlIHwgdGFpbCAtbiArNCkKICAgIGlmIFsgISAteiAiJHtybWkxfSIgLW8gISAteiAiJHtybWkyfSIgXTsgdGhlbgogICAgICAgIGVjaG8gIkNsZWFuaW5nIHVwIG9sZCBrZXJuZWwgbW9kdWxlIGNvbnRhaW5lciBidWlsZHMiCiAgICAgICAga3ZjX2Nfcm1pIC1mICRybWkxICRybWkyCiAgICBmaQp9Cgppc19rbW9kX2xvYWRlZCgpIHsKICAgIGlmICEgJChsc3BjaSAtZCAxYzJjOiB8IGdyZXAgLXEgU2lsaWNvbSkgOyB0aGVuCiAgICAgICAgZWNobyAiTm8gU2lsaWNvbSBGUEdBIGNhcmQgb24gdGhpcyBub2RlIgogICAgICAgIHJldHVybgogICAgZmkKCiAgICBtb2R1bGU9JHsxLy8tL199ICMgcmVwbGFjZSBhbnkgZGFzaGVzIHdpdGggdW5kZXJzY29yZQogICAgaWYgbHNtb2QgfCBncmVwICIke21vZHVsZX0iICY+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGVsc2UKICAgICAgICByZXR1cm4gMQogICAgZmkKfQoKYnVpbGRfa21vZHMoKSB7CiAgICBpZiAhICQobHNwY2kgLWQgMWMyYzogfCBncmVwIC1xIFNpbGljb20pIDsgdGhlbgogICAgICAgIGVjaG8gIk5vIFNpbGljb20gRlBHQSBjYXJkIG9uIHRoaXMgbm9kZSIKICAgICAgICByZXR1cm4KICAgIGZpCgogICAgIyBDaGVjayB0byBzZWUgaWYgaXQncyBhbHJlYWR5IHB1bGxlZAogICAgaWYgWyAteiAiJChrdmNfY19pbWFnZXMgJHtLTU9EX1JFUE9TfS8kSU1BR0UgLS1xdWlldCAyPi9kZXYvbnVsbCkiIF07IHRoZW4KICAgICAgICBlY2hvICJUaGUgJHtLTU9EX1JFUE9TfS8ke0lNQUdFfSBrZXJuZWwgbW9kdWxlIGNvbnRhaW5lciBoYXMgbm90IGJlZW4gYnVpbHQvcHVsbGVkIgogICAgICAgIHBvZG1hbiBwdWxsICR7S01PRF9SRVBPU30vJHtJTUFHRX0KICAgIGZpCgogICAgIyBTYW5pdHkgY2hlY2tzIGZvciBlYWNoIG1vZHVsZSB0byBsb2FkCiAgICBmb3IgbW9kdWxlIGluICR7S01PRF9OQU1FU307IGRvCiAgICAgICAgbW9kdWxlPSR7bW9kdWxlLy9fLy19ICMgcmVwbGFjZSBhbnkgdW5kZXJzY29yZXMgd2l0aCBkYXNoCiAgICAgICAgIyBTYW5pdHkgY2hlY2sgdG8gbWFrZSBzdXJlIHRoZSBidWlsdCBrZXJuZWwgbW9kdWxlcyB3ZXJlIHJlYWxseQogICAgICAgICMgYnVpbHQgYWdhaW5zdCB0aGUgY29ycmVjdCBtb2R1bGUgc29mdHdhcmUgdmVyc2lvbgogICAgICAgICMgTm90ZSB0aGUgdHIgdG8gZGVsZXRlIHRoZSB0cmFpbGluZyBjYXJyaWFnZSByZXR1cm4KICAgICAgICB4PSQoa3ZjX2NfcnVuICR7S01PRF9SRVBPU30vJElNQUdFIG1vZGluZm8gLUYgdmVyc2lvbiAiL2xpYi9tb2R1bGVzLyR7S1ZDX0tWRVJ9L2V4dHJhLyR7bW9kdWxlfS5rbyIgfCBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ciAtZCAnXHInKQogICAgICAgIGlmIFsgIiR7eH0iICE9ICIke0tNT0RWRVJ9IiBdOyB0aGVuCiAgICAgICAgICAgIGVjaG8gIk1vZHVsZSB2ZXJzaW9uIG1pc21hdGNoIHdpdGhpbiBjb250YWluZXIuIHJlYnVpbGRpbmcgJHtLTU9EX1JFUE9TfS8ke0lNQUdFfSIKICAgICAgICAgICAgZWNobyAiJHt4fSwgJHtLTU9EVkVSfSIKICAgICAgICAgICAgYnVpbGRfa21vZF9jb250YWluZXIKICAgICAgICBmaQogICAgICAgICMgU2FuaXR5IGNoZWNrIHRvIG1ha2Ugc3VyZSB0aGUgYnVpbHQga2VybmVsIG1vZHVsZXMgd2VyZSByZWFsbHkKICAgICAgICAjIGJ1aWx0IGFnYWluc3QgdGhlIGRlc2lyZWQga2VybmVsIHZlcnNpb24KICAgICAgICB4PSQoa3ZjX2NfcnVuICR7S01PRF9SRVBPU30vJElNQUdFIG1vZGluZm8gLUYgdmVybWFnaWMgIi9saWIvbW9kdWxlcy8ke0tWQ19LVkVSfS9leHRyYS8ke21vZHVsZX0ua28iIHwgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXQgLWQgJyAnIC1mIDEpCiAgICAgICAgaWYgWyAiJHt4fSIgIT0gIiR7S1ZDX0tWRVJ9IiBdOyB0aGVuCiAgICAgICAgICAgIGVjaG8gIk1vZHVsZSBub3QgYnVpbHQgYWdhaW5zdCAke0tNT0RWRVJ9LiByZWJ1aWxkaW5nICR7S01PRF9SRVBPU30vJHtJTUFHRX0iCiAgICAgICAgICAgIGVjaG8gIiR7eH0sICR7S1ZDX0tWRVJ9IgogICAgICAgICAgICBidWlsZF9rbW9kX2NvbnRhaW5lcgogICAgICAgIGZpCiAgICBkb25lCn0KCmxvYWRfa21vZHMoKSB7CiAgICBpZiAhICQobHNwY2kgLWQgMWMyYzogfCBncmVwIC1xIFNpbGljb20pIDsgdGhlbgogICAgICAgIGVjaG8gIk5vIFNpbGljb20gRlBHQSBjYXJkIG9uIHRoaXMgbm9kZSIKICAgICAgICByZXR1cm4KICAgIGZpCgogICAgZWNobyAiTG9hZGluZyBrZXJuZWwgbW9kdWxlcyB1c2luZyB0aGUga2VybmVsIG1vZHVsZSBjb250YWluZXIuLi4iCiAgICBmb3IgbW9kdWxlIGluICR7S01PRF9OQU1FU307IGRvCiAgICAgICAgaWYgaXNfa21vZF9sb2FkZWQgJHttb2R1bGV9OyB0aGVuCiAgICAgICAgICAgIGVjaG8gIktlcm5lbCBtb2R1bGUgJHttb2R1bGV9IGFscmVhZHkgbG9hZGVkIgogICAgICAgIGVsc2UKICAgICAgICAgICAgbW9kdWxlPSR7bW9kdWxlLy8tL199ICMgcmVwbGFjZSBhbnkgZGFzaGVzIHdpdGggdW5kZXJzY29yZQogICAgICAgICAgICBrdmNfY19ydW4gLS1wcml2aWxlZ2VkICR7S01PRF9SRVBPU30vJElNQUdFIG1vZHByb2JlIC1TICR7S1ZDX0tWRVJ9ICR7bW9kdWxlfQogICAgICAgIGZpCiAgICBkb25lCn0KCnVubG9hZF9rbW9kcygpIHsKICAgIGlmICEgJChsc3BjaSAtZCAxYzJjOiB8IGdyZXAgLXEgU2lsaWNvbSkgOyB0aGVuCiAgICAgICAgZWNobyAiTm8gU2lsaWNvbSBGUEdBIGNhcmQgb24gdGhpcyBub2RlIgogICAgICAgIHJldHVybgogICAgZmkKCiAgICBlY2hvICJVbmxvYWRpbmcga2VybmVsIG1vZHVsZXMuLi4iCiAgICBmb3IgbW9kdWxlIGluICR7S01PRF9OQU1FU307IGRvCiAgICAgICAgaWYgaXNfa21vZF9sb2FkZWQgJHttb2R1bGV9OyB0aGVuCiAgICAgICAgICAgIG1vZHVsZT0ke21vZHVsZS8vLS9ffSAjIHJlcGxhY2UgYW55IGRhc2hlcyB3aXRoIHVuZGVyc2NvcmUKICAgICAgICAgICAgcm1tb2QgIiR7bW9kdWxlfSIKICAgICAgICBlbHNlCiAgICAgICAgICAgIGVjaG8gIktlcm5lbCBtb2R1bGUgJHttb2R1bGV9IGFscmVhZHkgdW5sb2FkZWQiCiAgICAgICAgZmkKICAgIGRvbmUKfQoKd3JhcHBlcigpIHsKICAgIGlmICEgJChsc3BjaSAtZCAxYzJjOiB8IGdyZXAgLXEgU2lsaWNvbSkgOyB0aGVuCiAgICAgICAgZWNobyAiTm8gU2lsaWNvbSBGUEdBIGNhcmQgb24gdGhpcyBub2RlIgogICAgICAgIHJldHVybgogICAgZmkKCiAgICBlY2hvICJSdW5uaW5nIHVzZXJzcGFjZSB3cmFwcGVyIHVzaW5nIHRoZSBrZXJuZWwgbW9kdWxlIGNvbnRhaW5lci4uLiIKICAgIGt2Y19jX3J1biAtLXByaXZpbGVnZWQgJHtLTU9EX1JFUE9TfS8kSU1BR0UgJEAKfQo=
         mode: 420
         overwrite: true
         path: /usr/local/lib/kvc/dfl-kmod-lib.sh
       - contents:
           source: data:text/x-shellscript;charset=us-ascii;base64,IyEvYmluL2Jhc2gKIwojIFRoaXMgaXMgYSB0aGluIHdyYXBwZXIgdGhhdCBtYXBzIHVzZXJzcGFjZSB0b29scyAoZXhlY3V0YWJsZXMpCiMgdG8gYSBjb250YWluZXIgd2hlcmUgdGhleSBjYW4gYmUgcnVuLgoKa21vZHMtdmlhLWNvbnRhaW5lcnMgd3JhcHBlciBkZmwta21vZCAkKHVuYW1lIC1yKSAkKGJhc2VuYW1lICQwKSAkQAo=
         mode: 420
         overwrite: true
         path: /usr/local/lib/kvc/dfl-kmod-wrapper.sh
     systemd:
       units:
       - contents: '[Unit]
     
           Requires=kmods-via-containers@simple-kmod.service
     
           [Service]
     
           Type=oneshot
     
           ExecStart=/usr/bin/true
     
     
           [Install]
     
           WantedBy=multi-user.target
     
           '
         enabled: false
         name: require-kvc-simple-kmod.service
       - contents: '[Unit]
     
           Requires=kmods-via-containers@dfl-kmod.service
     
           [Service]
     
           Type=oneshot
     
           ExecStart=/usr/bin/true
     
     
           [Install]
     
           WantedBy=multi-user.target
     
           '
         enabled: true
         name: require-kvc-dfl-kmod.service
     
